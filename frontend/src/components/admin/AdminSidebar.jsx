import { useState, useEffect } from 'react';
import { Link, useLocation } from 'react-router-dom';

function AdminSidebar({ isExpanded: propIsExpanded, setIsExpanded, isMobileMenuOpen, setIsMobileMenuOpen }) {
    const [isExpanded, setIsExpandedLocal] = useState(false);
    const location = useLocation();

    // Use parent state if provided, otherwise use local state
    const expanded = propIsExpanded !== undefined ? propIsExpanded : isExpanded;
    const setExpanded = setIsExpanded || setIsExpandedLocal;

    useEffect(() => {
        const handleResize = () => {
            if (window.innerWidth >= 1024 && isMobileMenuOpen) {
                setIsMobileMenuOpen(false);
            }
        };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
    }, [isMobileMenuOpen, setIsMobileMenuOpen]);

    const menuItems = [
        { name: 'Dashboard', icon: 'dashboard', path: '/admin/dashboard' },
        { name: 'Stores & Registers', icon: 'stores', path: '/admin/stores' },
        { name: 'User & Roles', icon: 'users', path: '/admin/users' },
        { name: 'Products & Categories', icon: 'products', path: '/admin/products' },
        { name: 'Reports (Global)', icon: 'reports', path: '/admin/reports' },
        { name: 'Security & Backups', icon: 'security', path: '/admin/security' },
    ];

    const getIcon = (iconName) => {
        const icons = {
            dashboard: (
                <svg width="27" height="28" viewBox="0 0 27 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.65729 11.4005H3.74197C3.02073 11.3946 2.32666 11.6754 1.81246 12.1811C1.29824 12.6869 1.00601 13.3761 1.00006 14.0973V24.3041C1.01341 25.8054 2.24075 27.0118 3.74197 26.9992H8.65729C9.37847 27.0053 10.0726 26.7245 10.5869 26.2187C11.1011 25.713 11.3933 25.0237 11.3992 24.3023V14.0973C11.3933 13.3761 11.1011 12.6869 10.5869 12.1811C10.0726 11.6754 9.37847 11.3946 8.65729 11.4005Z" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    <path fillRule="evenodd" clipRule="evenodd" d="M8.65729 1.00105H3.74197C2.27094 0.960247 1.04441 2.11778 1.00006 3.5887V5.34615C1.04441 6.81709 2.27094 7.97462 3.74197 7.93381H8.65729C10.1283 7.97462 11.3548 6.81709 11.3992 5.34615V3.5887C11.3548 2.11778 10.1283 0.960247 8.65729 1.00105Z" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    <path fillRule="evenodd" clipRule="evenodd" d="M17.6074 16.6008H22.521C23.2426 16.6072 23.9371 16.3266 24.4516 15.8209C24.9662 15.315 25.2588 14.6255 25.2647 13.904V3.69889C25.2588 2.97768 24.9666 2.28835 24.4523 1.78259C23.9381 1.27683 23.244 0.99605 22.5228 1.00205H17.6074C16.8863 0.99605 16.1921 1.27683 15.6779 1.78259C15.1636 2.28835 14.8714 2.97768 14.8655 3.69889V13.904C14.8714 14.6252 15.1636 15.3145 15.6779 15.8202C16.1921 16.3259 16.8863 16.6067 17.6074 16.6008Z" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    <path fillRule="evenodd" clipRule="evenodd" d="M17.6074 26.9983H22.521C23.9927 27.04 25.2203 25.8823 25.2647 24.4106V22.6532C25.2203 21.1822 23.9937 20.0248 22.5228 20.0655H17.6074C16.1365 20.0248 14.9099 21.1822 14.8655 22.6532V24.4089C14.9089 25.8805 16.1358 27.039 17.6074 26.9983Z" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
            ),
            stores: (
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M160-720v-80h640v80H160Zm0 560v-240h-40v-80l40-200h640l40 200v80h-40v240h-80v-240H560v240H160Zm80-80h240v-160H240v160Zm-38-240h556-556Zm0 0h556l-24-120H226l-24 120Z"/>
                </svg>
            ),
            users: (
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113ZM120-240h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0 320Zm0-400Z"/>
                </svg>
            ),
            products: (
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M200-80q-33 0-56.5-23.5T120-160v-451q-18-11-29-28.5T80-680v-120q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v120q0 23-11 40.5T840-611v451q0 33-23.5 56.5T760-80H200Zm0-520v440h560v-440H200Zm-40-80h640v-120H160v120Zm200 280h240v-80H360v80Zm120 20Z"/>
                </svg>
            ),
            reports: (
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M280-280h80v-200h-80v200Zm320 0h80v-400h-80v400Zm-160 0h80v-120h-80v120Zm0-200h80v-80h-80v80ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z"/>
                </svg>
            ),
            security: (
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M480-80q-139-35-229.5-159.5T160-516v-244l320-120 320 120v244q0 152-90.5 276.5T480-80Zm0-84q104-33 172-132t68-220v-189l-240-90-240 90v189q0 121 68 220t172 132Zm0-316Z"/>
                </svg>
            ),
        };
        return icons[iconName] || null;
    };

    const isActive = (path) => {
        return location.pathname === path;
    };

    return (
        <>
            {/* Mobile Backdrop */}
            {isMobileMenuOpen && (
                <div 
                    className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
                    onClick={() => setIsMobileMenuOpen(false)}
                />
            )}
            
            {/* Sidebar */}
            <div 
                className={`fixed left-0 top-0 h-screen bg-[#000435] text-white transition-all duration-300 z-50
                    ${expanded ? 'w-64' : 'w-20'} 
                    ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}`}
                onMouseEnter={() => window.innerWidth >= 1024 && setExpanded(true)}
                onMouseLeave={() => window.innerWidth >= 1024 && setExpanded(false)}
            >
                {/* Header with Logo and Toggle */}
                <div className="flex items-center justify-center p-4 border-b border-gray-700">
                    {expanded && (
                        <svg width="201" height="78" viewBox="0 0 201 78" fill="none" className="w-36" xmlns="http://www.w3.org/2000/svg">
                            <path d="M162.43 35.9975L177.75 2.19506L183.922 3.99629L167.303 38.6651L199.209 56.1308L194.971 58.5516L165.218 43.0165L149.8 75.1836L144.488 75.5846L160.39 40.4961L126.935 23.0269L130.51 18.5243L162.43 35.9975Z" fill="white"/>
                            <path d="M31.6075 38.704L27.7195 52H24.0955L21.6715 42.712L19.2475 52H15.5995L11.6875 38.704H15.0955L17.4475 48.832L19.9915 38.704H23.5435L26.0395 48.808L28.3915 38.704H31.6075ZM32.5615 45.304C32.5615 43.96 32.8255 42.768 33.3535 41.728C33.8975 40.688 34.6255 39.888 35.5375 39.328C36.4655 38.768 37.4975 38.488 38.6335 38.488C39.6255 38.488 40.4895 38.688 41.2255 39.088C41.9775 39.488 42.5775 39.992 43.0255 40.6V38.704H46.4095V52H43.0255V50.056C42.5935 50.68 41.9935 51.2 41.2255 51.616C40.4735 52.016 39.6015 52.216 38.6095 52.216C37.4895 52.216 36.4655 51.928 35.5375 51.352C34.6255 50.776 33.8975 49.968 33.3535 48.928C32.8255 47.872 32.5615 46.664 32.5615 45.304ZM43.0255 45.352C43.0255 44.536 42.8655 43.84 42.5455 43.264C42.2255 42.672 41.7935 42.224 41.2495 41.92C40.7055 41.6 40.1215 41.44 39.4975 41.44C38.8735 41.44 38.2975 41.592 37.7695 41.896C37.2415 42.2 36.8095 42.648 36.4735 43.24C36.1535 43.816 35.9935 44.504 35.9935 45.304C35.9935 46.104 36.1535 46.808 36.4735 47.416C36.8095 48.008 37.2415 48.464 37.7695 48.784C38.3135 49.104 38.8895 49.264 39.4975 49.264C40.1215 49.264 40.7055 49.112 41.2495 48.808C41.7935 48.488 42.2255 48.04 42.5455 47.464C42.8655 46.872 43.0255 46.168 43.0255 45.352ZM53.0512 40.768C53.4832 40.064 54.0432 39.512 54.7312 39.112C55.4352 38.712 56.2352 38.512 57.1312 38.512V42.04H56.2432C55.1872 42.04 54.3872 42.288 53.8432 42.784C53.3152 43.28 53.0512 44.144 53.0512 45.376V52H49.6912V38.704H53.0512V40.768ZM71.7543 45.064C71.7543 45.544 71.7223 45.976 71.6583 46.36H61.9383C62.0183 47.32 62.3543 48.072 62.9463 48.616C63.5383 49.16 64.2663 49.432 65.1303 49.432C66.3783 49.432 67.2663 48.896 67.7943 47.824H71.4183C71.0343 49.104 70.2983 50.16 69.2103 50.992C68.1223 51.808 66.7863 52.216 65.2023 52.216C63.9223 52.216 62.7703 51.936 61.7463 51.376C60.7383 50.8 59.9463 49.992 59.3703 48.952C58.8103 47.912 58.5303 46.712 58.5303 45.352C58.5303 43.976 58.8103 42.768 59.3703 41.728C59.9303 40.688 60.7143 39.888 61.7223 39.328C62.7303 38.768 63.8903 38.488 65.2023 38.488C66.4663 38.488 67.5943 38.76 68.5863 39.304C69.5943 39.848 70.3703 40.624 70.9143 41.632C71.4743 42.624 71.7543 43.768 71.7543 45.064ZM68.2743 44.104C68.2583 43.24 67.9463 42.552 67.3383 42.04C66.7303 41.512 65.9863 41.248 65.1063 41.248C64.2743 41.248 63.5703 41.504 62.9943 42.016C62.4343 42.512 62.0903 43.208 61.9623 44.104H68.2743ZM81.6948 38.512C82.7028 38.512 83.5988 38.736 84.3828 39.184C85.1668 39.616 85.7748 40.264 86.2068 41.128C86.6548 41.976 86.8788 43 86.8788 44.2V52H83.5188V44.656C83.5188 43.6 83.2548 42.792 82.7268 42.232C82.1988 41.656 81.4788 41.368 80.5668 41.368C79.6388 41.368 78.9028 41.656 78.3588 42.232C77.8308 42.792 77.5668 43.6 77.5668 44.656V52H74.2068V34.24H77.5668V40.36C77.9988 39.784 78.5748 39.336 79.2948 39.016C80.0148 38.68 80.8148 38.512 81.6948 38.512ZM95.978 52.216C94.698 52.216 93.546 51.936 92.522 51.376C91.498 50.8 90.69 49.992 90.098 48.952C89.522 47.912 89.234 46.712 89.234 45.352C89.234 43.992 89.53 42.792 90.122 41.752C90.73 40.712 91.554 39.912 92.594 39.352C93.634 38.776 94.794 38.488 96.074 38.488C97.354 38.488 98.514 38.776 99.554 39.352C100.594 39.912 101.41 40.712 102.002 41.752C102.61 42.792 102.914 43.992 102.914 45.352C102.914 46.712 102.602 47.912 101.978 48.952C101.37 49.992 100.538 50.8 99.482 51.376C98.442 51.936 97.274 52.216 95.978 52.216ZM95.978 49.288C96.586 49.288 97.154 49.144 97.682 48.856C98.226 48.552 98.658 48.104 98.978 47.512C99.298 46.92 99.458 46.2 99.458 45.352C99.458 44.088 99.122 43.12 98.45 42.448C97.794 41.76 96.986 41.416 96.026 41.416C95.066 41.416 94.258 41.76 93.602 42.448C92.962 43.12 92.642 44.088 92.642 45.352C92.642 46.616 92.954 47.592 93.578 48.28C94.218 48.952 95.018 49.288 95.978 49.288ZM117.931 38.704V52H114.547V50.32C114.115 50.896 113.547 51.352 112.843 51.688C112.155 52.008 111.403 52.168 110.587 52.168C109.547 52.168 108.627 51.952 107.827 51.52C107.027 51.072 106.395 50.424 105.931 49.576C105.483 48.712 105.259 47.688 105.259 46.504V38.704H108.619V46.024C108.619 47.08 108.883 47.896 109.411 48.472C109.939 49.032 110.659 49.312 111.571 49.312C112.499 49.312 113.227 49.032 113.755 48.472C114.283 47.896 114.547 47.08 114.547 46.024V38.704H117.931ZM126.334 52.216C125.246 52.216 124.27 52.024 123.406 51.64C122.542 51.24 121.854 50.704 121.342 50.032C120.846 49.36 120.574 48.616 120.526 47.8H123.91C123.974 48.312 124.222 48.736 124.654 49.072C125.102 49.408 125.654 49.576 126.31 49.576C126.95 49.576 127.446 49.448 127.798 49.192C128.166 48.936 128.35 48.608 128.35 48.208C128.35 47.776 128.126 47.456 127.678 47.248C127.246 47.024 126.55 46.784 125.59 46.528C124.598 46.288 123.782 46.04 123.142 45.784C122.518 45.528 121.974 45.136 121.51 44.608C121.062 44.08 120.838 43.368 120.838 42.472C120.838 41.736 121.046 41.064 121.462 40.456C121.894 39.848 122.502 39.368 123.286 39.016C124.086 38.664 125.022 38.488 126.094 38.488C127.678 38.488 128.942 38.888 129.886 39.688C130.83 40.472 131.35 41.536 131.446 42.88H128.23C128.182 42.352 127.958 41.936 127.558 41.632C127.174 41.312 126.654 41.152 125.998 41.152C125.39 41.152 124.918 41.264 124.582 41.488C124.262 41.712 124.102 42.024 124.102 42.424C124.102 42.872 124.326 43.216 124.774 43.456C125.222 43.68 125.918 43.912 126.862 44.152C127.822 44.392 128.614 44.64 129.238 44.896C129.862 45.152 130.398 45.552 130.846 46.096C131.31 46.624 131.55 47.328 131.566 48.208C131.566 48.976 131.35 49.664 130.918 50.272C130.502 50.88 129.894 51.36 129.094 51.712C128.31 52.048 127.39 52.216 126.334 52.216ZM146.684 45.064C146.684 45.544 146.652 45.976 146.588 46.36H136.868C136.948 47.32 137.284 48.072 137.876 48.616C138.468 49.16 139.196 49.432 140.06 49.432C141.308 49.432 142.196 48.896 142.724 47.824H146.348C145.964 49.104 145.228 50.16 144.14 50.992C143.052 51.808 141.716 52.216 140.132 52.216C138.852 52.216 137.7 51.936 136.676 51.376C135.668 50.8 134.876 49.992 134.3 48.952C133.74 47.912 133.46 46.712 133.46 45.352C133.46 43.976 133.74 42.768 134.3 41.728C134.86 40.688 135.644 39.888 136.652 39.328C137.66 38.768 138.82 38.488 140.132 38.488C141.396 38.488 142.524 38.76 143.516 39.304C144.524 39.848 145.3 40.624 145.844 41.632C146.404 42.624 146.684 43.768 146.684 45.064ZM143.204 44.104C143.188 43.24 142.876 42.552 142.268 42.04C141.66 41.512 140.916 41.248 140.036 41.248C139.204 41.248 138.5 41.504 137.924 42.016C137.364 42.512 137.02 43.208 136.892 44.104H143.204Z" fill="white"/>
                        </svg>
                    )}
                    {!expanded && (
                        <svg className='w-12' viewBox="0 0 73 74" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M35.495 33.8022L50.8158 -0.000254333L56.9878 1.80098L40.3688 36.4698L72.2748 53.9355L68.0368 56.3563L38.2832 40.8212L22.865 72.9883L17.5535 73.3893L33.4558 38.3008L3.33488e-05 20.8316L3.57525 16.329L35.495 33.8022Z" fill="white"/>
                        </svg>
                    )}
                </div>

                {/* Menu Items */}
                <nav className="mt-8 space-y-2 px-3">
                    {menuItems.map((item) => (
                        <Link
                            key={item.name}
                            to={item.path}
                            onClick={() => isMobileMenuOpen && setIsMobileMenuOpen(false)}
                            className={`flex items-center space-x-4 px-4 py-3 rounded-lg transition-colors hover:bg-gray-700 ${
                                isActive(item.path) ? 'bg-gray-700' : ''
                            }`}
                        >
                            <div className="w-6 h-6 flex-shrink-0">
                                {getIcon(item.icon)}
                            </div>
                            {expanded && <span className="text-sm font-medium text-left">{item.name}</span>}
                        </Link>
                    ))}
                </nav>

                {/* User Profile at Bottom */}
                <div className="absolute bottom-6 left-0 right-0 px-3">
                    <div className={`flex flex-col items-center ${expanded ? 'space-x-3' : 'justify-center'} p-3 rounded-lg bg-gray-800`}>
                        <div className="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                            A
                        </div>
                        {expanded && (
                            <div className="flex-1 text-center mt-2">
                                <p className="text-sm font-semibold">Admin</p>
                                <p className="text-sm text-gray-300">Alex Daniels</p>
                                <p className="text-xs text-gray-400">oladiramustapha@mail.com</p>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </>
    );
}

export default AdminSidebar;
